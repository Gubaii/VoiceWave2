<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äºŒç»´ç æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background: #0056b3;
        }
        .qr-container {
            text-align: center;
            margin: 20px 0;
        }
        .url-display {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            word-break: break-all;
            font-family: monospace;
            font-size: 14px;
            margin: 10px 0;
        }
        .result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ” äºŒç»´ç æµ‹è¯•</h1>
            <p>æµ‹è¯•ç¼–è¾‘é¡µé¢ç”Ÿæˆçš„äºŒç»´ç æ˜¯å¦èƒ½æ­£ç¡®å·¥ä½œ</p>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•1: æ¨¡æ‹Ÿç¼–è¾‘é¡µé¢äºŒç»´ç ç”Ÿæˆ</h3>
            <p>æ¨¡æ‹Ÿç¼–è¾‘é¡µé¢çš„äºŒç»´ç ç”Ÿæˆé€»è¾‘ï¼Œç”Ÿæˆä¸€ä¸ªæŒ‡å‘æ’­æ”¾é¡µé¢çš„äºŒç»´ç </p>
            
            <button class="btn" onclick="generateTestQR1()">ç”Ÿæˆæµ‹è¯•äºŒç»´ç 1</button>
            <button class="btn" onclick="generateTestQR2()">ç”Ÿæˆæµ‹è¯•äºŒç»´ç 2</button>
            
            <div id="testQR1" class="qr-container"></div>
            <div id="testQR2" class="qr-container"></div>
            
            <div id="testResult1" class="result hidden"></div>
            <div id="testResult2" class="result hidden"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•2: éªŒè¯æ’­æ”¾é¡µé¢URL</h3>
            <p>éªŒè¯ç”Ÿæˆçš„æ’­æ”¾é¡µé¢URLæ˜¯å¦èƒ½æ­£ç¡®è®¿é—®</p>
            
            <div id="urlDisplay" class="url-display hidden"></div>
            <button class="btn" onclick="testPlayPage()">æµ‹è¯•æ’­æ”¾é¡µé¢</button>
            
            <div id="playTestResult" class="result hidden"></div>
        </div>

        <div class="test-section">
            <h3>æµ‹è¯•3: ä»localStorageè¯»å–æ•°æ®</h3>
            <p>æ£€æŸ¥localStorageä¸­æ˜¯å¦æœ‰æ­£ç¡®çš„éŸ³é¢‘æ•°æ®</p>
            
            <button class="btn" onclick="checkLocalStorage()">æ£€æŸ¥localStorage</button>
            
            <div id="storageResult" class="result hidden"></div>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿç¼–è¾‘é¡µé¢çš„äºŒç»´ç ç”Ÿæˆé€»è¾‘
        function generateTestQR1() {
            const container = document.getElementById('testQR1');
            container.innerHTML = '';
            
            // æ¨¡æ‹Ÿäº‘å­˜å‚¨éŸ³é¢‘URL
            const cloudAudioUrl = 'https://mp-71407943-224d-4e7e-a1f9-e6e1b9bd6d81.cdn.bspapp.com/cloudstorage/voicewave_1703123456789.webm';
            const simpleFileId = 'voicewave_1703123456789.webm';
            
            // ç”Ÿæˆæ’­æ”¾é¡µé¢URL
            const playUrl = generatePlayUrl(cloudAudioUrl, simpleFileId);
            
            // ç”ŸæˆäºŒç»´ç  - ä½¿ç”¨ä½å®¹é”™ç‡
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(playUrl)}&ecc=L&margin=3`;
            
            const img = document.createElement('img');
            img.src = qrUrl;
            img.alt = 'æµ‹è¯•äºŒç»´ç 1';
            img.style.maxWidth = '200px';
            img.style.height = 'auto';
            
            container.appendChild(img);
            
            // æ˜¾ç¤ºURL
            const result = document.getElementById('testResult1');
            result.innerHTML = `
                <strong>ç”Ÿæˆçš„æ’­æ”¾é¡µé¢URL:</strong><br>
                <code>${playUrl}</code>
            `;
            result.className = 'result success';
            result.classList.remove('hidden');
            
            // ä¿å­˜URLç”¨äºæµ‹è¯•
            window.testPlayUrl1 = playUrl;
        }

        function generateTestQR2() {
            const container = document.getElementById('testQR2');
            container.innerHTML = '';
            
            // æ¨¡æ‹Ÿæœ¬åœ°éŸ³é¢‘
            const timestamp = Date.now();
            const playUrl = `${window.location.origin}/play.html?id=${timestamp}&local=true`;
            
            // ç”ŸæˆäºŒç»´ç  - ä½¿ç”¨ä½å®¹é”™ç‡
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(playUrl)}&ecc=L&margin=3`;
            
            const img = document.createElement('img');
            img.src = qrUrl;
            img.alt = 'æµ‹è¯•äºŒç»´ç 2';
            img.style.maxWidth = '200px';
            img.style.height = 'auto';
            
            container.appendChild(img);
            
            // æ˜¾ç¤ºURL
            const result = document.getElementById('testResult2');
            result.innerHTML = `
                <strong>ç”Ÿæˆçš„æ’­æ”¾é¡µé¢URL:</strong><br>
                <code>${playUrl}</code>
            `;
            result.className = 'result success';
            result.classList.remove('hidden');
            
            // ä¿å­˜URLç”¨äºæµ‹è¯•
            window.testPlayUrl2 = playUrl;
        }

        // ç”Ÿæˆæ’­æ”¾é¡µé¢URLï¼ˆæ¨¡æ‹Ÿç¼–è¾‘é¡µé¢çš„é€»è¾‘ï¼‰
        function generatePlayUrl(cloudAudioUrl, simpleFileId) {
            const hostname = window.location.hostname;
            const protocol = window.location.protocol;
            const port = window.location.port;
            
            let baseUrl;
            if (hostname === 'localhost' || hostname === '127.0.0.1') {
                baseUrl = `${protocol}//${hostname}${port ? ':' + port : ''}`;
            } else {
                baseUrl = `${protocol}//${hostname}${port ? ':' + port : ''}`;
            }
            
            const playUrl = new URL(`${baseUrl}/play.html`);
            playUrl.searchParams.set('audioUrl', cloudAudioUrl);
            if (simpleFileId) {
                playUrl.searchParams.set('fileId', simpleFileId);
            }
            playUrl.searchParams.set('timestamp', Date.now());
            
            return playUrl.toString();
        }

        // æµ‹è¯•æ’­æ”¾é¡µé¢
        function testPlayPage() {
            const url = window.testPlayUrl1 || window.testPlayUrl2;
            if (!url) {
                showResult('playTestResult', 'è¯·å…ˆç”Ÿæˆæµ‹è¯•äºŒç»´ç ', 'error');
                return;
            }
            
            const urlDisplay = document.getElementById('urlDisplay');
            urlDisplay.textContent = url;
            urlDisplay.classList.remove('hidden');
            
            // å°è¯•è®¿é—®æ’­æ”¾é¡µé¢
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        showResult('playTestResult', 'âœ… æ’­æ”¾é¡µé¢å¯ä»¥æ­£å¸¸è®¿é—®', 'success');
                    } else {
                        showResult('playTestResult', `âŒ æ’­æ”¾é¡µé¢è®¿é—®å¤±è´¥: ${response.status}`, 'error');
                    }
                })
                .catch(error => {
                    showResult('playTestResult', `âŒ æ’­æ”¾é¡µé¢è®¿é—®å¤±è´¥: ${error.message}`, 'error');
                });
        }

        // æ£€æŸ¥localStorage
        function checkLocalStorage() {
            const result = document.getElementById('storageResult');
            const data = {};
            
            // æ£€æŸ¥ç›¸å…³çš„localStorageé¡¹
            const keys = [
                'isCloudAudio',
                'cloudAudioUrl', 
                'simpleFileId',
                'audioPlayUrl',
                'recordingTimestamp',
                'recordedAudio'
            ];
            
            keys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    data[key] = value.length > 100 ? value.substring(0, 100) + '...' : value;
                }
            });
            
            if (Object.keys(data).length === 0) {
                showResult('storageResult', 'âŒ localStorageä¸­æ²¡æœ‰æ‰¾åˆ°éŸ³é¢‘æ•°æ®', 'error');
            } else {
                const dataStr = JSON.stringify(data, null, 2);
                showResult('storageResult', `âœ… æ‰¾åˆ°localStorageæ•°æ®:\n<pre>${dataStr}</pre>`, 'success');
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.className = `result ${type}`;
            element.classList.remove('hidden');
        }
    </script>
</body>
</html> 